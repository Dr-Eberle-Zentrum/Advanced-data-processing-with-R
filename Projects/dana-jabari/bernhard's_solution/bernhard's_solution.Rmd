---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---


```{r}
library(stringr)
library(tidyverse)
data <- read.csv("https://raw.githubusercontent.com/Dr-Eberle-Zentrum/Advanced-data-processing-with-R/main/Projects/dana-jabari/cloze_task_results.csv")

# extraction of the keyword
data$keyword <- sub("," , "", str_extract_all(data$text, "\\w+,"))

data$keyword <- factor(data$keyword)

# filter out the 'best alternatives'
data |> 
  group_by(keyword) |>
  filter(count == max(count)) -> data

# make response uppercase
data$response <- str_to_title(data$response)

# remove empty responses
data <- data[data$response != "",]

# remove duplicated entries due to same response count
data <- data[!duplicated(data$keyword),]
print(data)
```

```{r, echo=FALSE, fig.height = 6}



data |>
  filter(count > 20) |>
  mutate(keyword = fct_reorder(keyword, count, .desc = TRUE)) |>
  ggplot(aes(x = reorder(keyword, + count), y = count)) +
  geom_bar(stat = "identity", width = 0.8, fill = "wheat3", color = "black") +
  coord_flip() +
  geom_text(aes(label = str_c(response, " ", count)), hjust = 1, nudge_y = -0.5) +
  ylim(0, 50) +
  labs(title = "Keywords and their responses with more than 20 counts") +
  ylab("Keyword") +
  xlab("Count") +
  theme_classic()

data |>
  filter(count > 14) |>
  filter(count <= 20) |>
  mutate(keyword = fct_reorder(keyword, count, .desc = TRUE)) |>
  ggplot(aes(x = reorder(keyword, + count), y = count)) +
  geom_bar(stat = "identity", width = 0.8, fill = "wheat3", color = "black") +
  coord_flip() +
  geom_text(aes(label = str_c(response, " ", count)), hjust = 1, nudge_y = -0.5) +
  ylim(0, 50) +
  labs(title = "Keywords and their responses with more than 14 and less than 21 counts") +
  ylab("Keyword") +
  xlab("Count") +
  theme_classic()

data |>
  filter(count > 10) |>
  filter(count <= 14) |>
  mutate(keyword = fct_reorder(keyword, count, .desc = TRUE)) |>
  ggplot(aes(x = reorder(keyword, + count), y = count)) +
  geom_bar(stat = "identity", width = 0.8, fill = "wheat3", color = "black") +
  coord_flip() +
  geom_text(aes(label = str_c(response, " ", count)), hjust = 1, nudge_y = -0.5) +
  ylim(0, 50) +
  labs(title = "Keywords and their responses with more than 10 an less than 15 counts") +
  ylab("Keyword") +
  xlab("Count") +
  theme_classic()

data |>
  filter(count <= 10) |>
  mutate(keyword = fct_reorder(keyword, count, .desc = TRUE)) |>
  ggplot(aes(x = reorder(keyword, + count), y = count)) +
  geom_bar(stat = "identity", width = 0.8, fill = "wheat3", color = "black") +
  coord_flip() +
  geom_text(aes(label = str_c(response, " ", count)), hjust = 1, nudge_y = -0.5) +
  ylim(0, 50) +
  labs(title = "Keywords and their responses with less than 11 counts") +
  ylab("Keyword") +
  xlab("Count") +
  theme_classic()
```
